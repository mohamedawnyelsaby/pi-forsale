<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Network Live</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        body { background: #000; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .btn { 
            background: #F8B62C; color: black; font-size: 20px; font-weight: bold;
            padding: 15px; width: 100%; border: none; border-radius: 10px; margin-top: 20px;
            display: none; cursor: pointer;
        }
        #status { margin-top: 20px; color: #00f2ff; font-size: 18px; }
        .error { color: #ff4444; font-size: 14px; margin-top: 10px; border: 1px solid #ff4444; padding: 10px; display: none; }
    </style>
</head>
<body>

    <h1>Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Live)</h1>
    <p id="status">Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Pi Network...</p>

    <button id="loginBtn" class="btn" onclick="startLogin()">ğŸ”— Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¢Ù†</button>
    <div id="error-box" class="error"></div>

    <script>
        // 1. Ø§Ù„ØªÙ‡ÙŠØ¦Ø© (Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„Ø³Ø§Ù†Ø¯Ø¨ÙˆÙƒØ³)
        document.addEventListener("DOMContentLoaded", () => {
            try {
                // Ø§Ù„ØªØºÙŠÙŠØ± Ù‡Ù†Ø§: sandbox: false
                Pi.init({ version: "2.0", sandbox: false });
                
                document.getElementById('status').innerText = "âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø². Ø§Ø¶ØºØ· Ù„Ù„Ø±Ø¨Ø·.";
                document.getElementById('loginBtn').style.display = "block";
            } catch (err) {
                showError("ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©: " + err);
            }
        });

        // 2. Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function startLogin() {
            const btn = document.getElementById('loginBtn');
            btn.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...";
            btn.disabled = true;

            try {
                const scopes = ['username', 'payments'];
                const auth = await Pi.authenticate(scopes, onIncomplete);
                
                // Ù†Ø¬Ø§Ø­
                document.getElementById('status').innerText = "ğŸ‰ ØªÙ… Ø§Ù„Ø±Ø¨Ø·: " + auth.user.username;
                document.getElementById('status').style.color = "#00c851";
                btn.innerHTML = "ØªÙ… Ø¨Ù†Ø¬Ø§Ø­ âœ”ï¸";
                alert("Ù†Ø¬Ø­ Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ø®ÙŠØ±Ø§Ù‹!");

            } catch (err) {
                // ÙØ´Ù„
                btn.innerHTML = "âŒ ÙØ´Ù„ - Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
                btn.disabled = false;
                showError("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©: " + err);
            }
        }

        function onIncomplete(p) { console.log(p); }

        function showError(msg) {
            const box = document.getElementById('error-box');
            box.style.display = "block";
            box.innerText = msg;
        }
    </script>
</body>
</html>
