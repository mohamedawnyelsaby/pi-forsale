<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Connection Test</title>
    
    <!-- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…ÙƒØªØ¨Ø© -->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <style>
        body { background-color: #000; color: #0f0; font-family: monospace; padding: 20px; font-size: 16px; }
        button { 
            background: #fff; color: #000; font-size: 20px; padding: 15px; 
            width: 100%; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;
        }
        #logs { border-top: 1px solid #333; padding-top: 10px; }
        .log-line { margin-bottom: 5px; border-bottom: 1px dashed #333; padding-bottom: 2px; }
        .error { color: #ff5252; }
        .success { color: #ffff00; font-weight: bold; }
    </style>
</head>
<body>

    <h1>ØªØ¬Ø±Ø¨Ø© Ø¨Ø¯ÙˆÙ† ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h1>
    <button onclick="startAuth()">ğŸ”´ Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„Ø§ØªØµØ§Ù„</button>

    <h3>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:</h3>
    <div id="logs">...</div>

    <script>
        // Ø¯Ø§Ù„Ø© Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
        function log(msg, type = '') {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.innerHTML = `<div class="log-line ${type}">[${time}] ${msg}</div>` + logs.innerHTML;
        }

        // 1. Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        try {
            log("Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Pi SDK...");
            // Ø¬Ø±Ø¨Ù†Ø§ Ù†Ø´ÙŠÙ„ sandbox Ø¹Ø´Ø§Ù† Ù†ØªØ£ÙƒØ¯
            Pi.init({ version: "2.0", sandbox: true });
            log("âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© SDK Ø¨Ù†Ø¬Ø§Ø­.");
        } catch (e) {
            log("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©: " + e, 'error');
        }

        // 2. Ø§Ù„Ø§ØªØµØ§Ù„
        async function startAuth() {
            log("--- Ø¨Ø¯Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ---");
            
            try {
                const scopes = ['username', 'payments'];
                
                log("â³ Ø¬Ø§Ø±ÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯ Pi Browser...");
                
                // Ø¹Ù…Ù„Ù†Ø§ Ø®Ø¯Ø¹Ø©: Ù„Ùˆ Ù…Ø§Ø±Ø¯Ø´ Ø®Ù„Ø§Ù„ 10 Ø«ÙˆØ§Ù†ÙŠ Ù†Ø·Ù„Ø¹ Ø®Ø·Ø£
                const authPromise = Pi.authenticate(scopes, onIncomplete);
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨."), 10000)
                );

                const auth = await Promise.race([authPromise, timeoutPromise]);

                log("ğŸ‰ Ù†Ø¬Ø­ Ø§Ù„Ø§ØªØµØ§Ù„!", 'success');
                log("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + auth.user.username, 'success');
                log("Token: " + auth.accessToken.substring(0, 15) + "...", 'success');

            } catch (err) {
                log("âŒ ÙØ´Ù„: " + err, 'error');
                log("ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†.", 'error');
            }
        }

        function onIncomplete(p) { log("Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©: " + p.identifier); }
    </script>
</body>
</html>
