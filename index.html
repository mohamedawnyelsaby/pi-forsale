<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-ar="Ø³ÙˆÙ‚ Forsale (ØªØ¬Ø±ÙŠØ¨ÙŠ)" data-en="Forsale Marketplace (Mock)">Ø³ÙˆÙ‚ Forsale (ØªØ¬Ø±ÙŠØ¨ÙŠ)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø«ÙˆØ§Ø¨Øª */
        :root {
            --primary: #FFD400;             /* Ø°Ù‡Ø¨ÙŠ */
            --secondary: #0D1B2A;           /* ÙƒØ­Ù„ÙŠ ØºØ§Ù…Ù‚ - ÙŠØ³ØªØ®Ø¯Ù… ÙƒØ®Ù„ÙÙŠØ© Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
            --background: #08121a;          /* Ø£Ø³ÙˆØ¯ / Ø£Ø²Ø±Ù‚ ØºØ§Ù…Ù‚ Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©) */
            --background-light: #1A2E44;    /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ø­ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
            --background-dark: #050b10;     /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ÙˆØ§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª */
            --text-light: #FFF;             /* Ù†Øµ Ø£Ø¨ÙŠØ¶ */
            --text-muted: #99AAB5;          /* Ù†Øµ Ø«Ø§Ù†ÙˆÙŠ (Ø±Ù…Ø§Ø¯ÙŠ Ø¨Ø§Ù‡Øª) */
            --success: #2ECC71;             /* Ø£Ø®Ø¶Ø± (ØªØ·Ø¹ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚) */
            --danger: #E74C3C;              /* Ø£Ø­Ù…Ø± (ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ£Ø²Ø±Ø§Ø± Ø§Ù„Ø®Ø±ÙˆØ¬) */
            --danger-dark: #B92F2F;
            --accent: #4A90E2;              /* Ø£Ø²Ø±Ù‚ (ØªØ³ØªØ®Ø¯Ù… ÙƒØªÙ…ÙŠÙŠØ² Ø«Ø§Ù†ÙˆÙŠ) */
            --radius: 8px;
        }

        body {
            background: var(--background);
            color: var(--text-muted);
            margin: 0;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 10px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .header {
            background: var(--background-dark);
            padding: 10px 6px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid var(--background-light);
        }

        .logo {
            color: var(--primary);
            font-size: 21px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-inline-end: 9px;
        }

        .status-bar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 7px;
            color: var(--text-light);
        }

        .status-indicator i.fa-circle-check {
            color: var(--success); /* Ø£Ø®Ø¶Ø± Ø§Ù„Ù†Ø¬Ø§Ø­ */
        }

        .status-indicator i.fa-circle-xmark {
            color: var(--danger);
        }

        .status-text {
            display: flex;
            flex-direction: column;
            line-height: 1.1;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ù…Ø© */
        .action-btn {
            padding: 7px 14px;
            border: none;
            border-radius: var(--radius);
            font-weight: bold;
            cursor: pointer;
            transition: background .2s;
            color: var(--text-light);
            background: var(--background-light);
        }

        .action-btn:hover:not(:disabled) {
            opacity: .9;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #connectBtn { background: var(--secondary); }
        #netBtn { background: var(--primary); color: var(--secondary); } /* Ø°Ù‡Ø¨ÙŠ Ù…Ø¹ ÙƒØªØ§Ø¨Ø© ÙƒØ­Ù„ÙŠØ© */
        #logoutBtn { background: var(--danger-dark); margin-inline-end: 4px; }
        #langToggleTop { background: var(--accent); }
        #verifyBtn { background: var(--success); }
        #sellBtn { background: var(--accent); }
        #ordersBtn { background: var(--primary); color: var(--secondary); }


        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¨Ø­Ø« */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin: 14px 0;
        }

        .search-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            background: var(--background-light);
            border-radius: var(--radius);
            padding: 6px;
        }

        .search-container input {
            flex-grow: 1;
            padding: 8px;
            background: none;
            border: none;
            color: var(--text-light);
        }

        .search-container input:focus {
            outline: none;
        }

        .search-container button {
            background: var(--primary);
            color: var(--secondary);
            padding: 7px 12px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
        }

        .sort-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-layout {
            display: grid;
            grid-template-columns: 2.5fr 1fr;
            gap: 16px;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
        .category-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .cat {
            background: var(--background-light); /* ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯Ø§ÙƒÙ†Ø© */
            color: var(--text-light);
            padding: 6px 12px;
            border-radius: var(--radius);
            margin-bottom: 4px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }

        .cat:hover, .cat.active {
            background: var(--primary); /* Ø°Ù‡Ø¨ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ */
            color: var(--secondary);
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        #productList {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬ÙŠÙ† ÙÙŠ Ø§Ù„ØµÙ */
            gap: 15px;
        }
        
        @media (min-width: 900px) {
            #productList {
                grid-template-columns: 1fr 1fr 1fr; /* 3 Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„ØµÙ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
            }
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ */
        .product {
            background: var(--background-light);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            transition: transform 0.2s;
        }
        
        .product:hover {
            transform: translateY(-3px);
        }

        .product img {
            width: 100%;
            height: 125px;
            object-fit: cover;
            cursor: pointer;
        }

        .product-content {
            padding: 10px;
        }

        .product .title {
            color: var(--primary);
            font-size: 15px;
            font-weight: bold;
        }

        .product .desc {
            font-size: 13px;
            color: var(--text-muted);
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 7px;
        }

        .price {
            color: var(--primary);
            font-size: 15px;
            font-weight: bold;
        }

        .seller-rating {
            color: var(--success);
            font-size: 13px;
        }

        .ai-badge {
            position: absolute;
            top: 9px;
            left: 9px;
            background: var(--success);
            color: var(--secondary);
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
        }

        .verified-badge {
            position: absolute;
            top: 9px;
            right: 9px;
            background: var(--primary); /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ù‡Ù†Ø§ Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */
            color: var(--secondary);
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar-area {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sidebar-panel {
            background: var(--background-light);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 11px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
        }

        .sidebar-panel h3 {
            color: var(--primary);
            font-size: 16px;
            margin-bottom: 7px;
        }

        #cartTotal .total-pi {
            color: var(--primary);
        }
        
        .log-controls button {
            width: 100%;
            margin-top: 10px;
            background: var(--background-dark);
            border: 1px solid var(--text-muted);
        }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        #logyFloatingBtn, #disputeFloatingBtn {
            position: fixed;
            bottom: 22px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 25px;
            z-index: 1000;
            cursor: pointer;
        }

        #logyFloatingBtn {
            left: 17px;
            background: var(--success);
            color: #fff;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }

        #disputeFloatingBtn {
            right: 17px;
            background: var(--primary); /* Ø°Ù‡Ø¨ÙŠ Ù„Ù„Ù†Ø²Ø§Ø¹Ø§Øª */
            color: var(--secondary);
            box-shadow: 0 4px 12px rgba(255, 212, 0, 0.4);
        }
        
        .cart-row {
            margin-bottom: 6px;
            border-bottom: 1px dashed #222;
            display: flex;
            align-items: center;
            padding: 5px 0;
        }

        .cart-qty {
            padding: 3px 7px;
            font-weight: bold;
        }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(18, 25, 35, .9);
            z-index: 5000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--background-light);
            padding: 18px;
            border-radius: var(--radius);
            max-width: 500px;
            width: 93vw;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 26px;
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
        }
        
        /* Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            color: var(--text-light);
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: bold;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            background: var(--background-dark);
            border: 1px solid var(--accent);
            border-radius: var(--radius);
            color: var(--text-light);
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        /* Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */
        .verification-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 15px 0;
        }

        .verification-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--background-dark);
            border-radius: var(--radius);
        }

        .verification-step.completed {
            border-left: 3px solid var(--success);
        }

        .step-number {
            width: 35px;
            height: 35px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-number.completed {
            background: var(--success);
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„Ù†Ø²Ø§Ø¹Ø§Øª */
        .tracking-status, .analyzer-result {
            margin-top: 10px;
            padding: 10px;
            background: var(--background-dark);
            border-radius: var(--radius);
            color: var(--text-light);
            font-size: 14px;
        }

        .analyzer-result.fail {
            border-left: 3px solid var(--danger);
        }

        .dispute-item {
            padding: 8px;
            margin-bottom: 8px;
            border-bottom: 1px solid #333;
            font-size: 14px;
        }

        .dispute-status {
            font-weight: bold;
            color: var(--danger);
        }

        .dispute-status.resolved {
            color: var(--success);
        }
        
        .seller-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px dotted #333;
        }

        .order-card {
            background: var(--background-dark);
            padding: 12px;
            border-radius: var(--radius);
            margin-bottom: 10px;
            border-left: 4px solid var(--accent);
        }
        .order-card h4 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 5px;
        }
        .order-status {
            font-weight: bold;
            color: var(--success);
        }

        /* Product Modal Enhancements */
        #productModal .modal-content {
            max-width: 750px; /* Wider modal for two columns */
        }

        .product-modal-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: flex-start;
        }

        .product-modal-image-col img {
            width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: cover;
            border-radius: var(--radius);
        }

        .product-modal-details-col {
            display: flex;
            flex-direction: column;
        }

        #modalTitle {
            color: var(--primary);
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        #modalRating {
            color: var(--success);
            margin-bottom: 15px;
            font-size: 16px;
        }

        #modalDesc {
            margin-bottom: 15px;
            font-size: 15px;
            line-height: 1.6;
        }

        #modalPrice {
            color: var(--primary);
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .add-to-cart-btn {
            width: 100%;
            background: var(--success);
            padding: 12px;
            font-size: 16px;
        }

        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 800px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .sidebar-area {
                width: 100%;
            }
            #productList {
                grid-template-columns: 1fr;
            }
            .product-modal-layout {
                grid-template-columns: 1fr; /* Stack on mobile */
            }
        }
    </style>
</head>
<body>
<div class="header">
    <div class="logo"><i class="fa-solid fa-store"></i> <span id="titleText">Forsale</span></div>
    <div class="status-bar">
        <div class="status-indicator">
            <i id="statusIcon" class="fa-solid fa-circle-xmark"></i>
            <div class="status-text">
                <div class="username-text" id="usernameText" data-ar="ØºÙŠØ± Ù…ØªØµÙ„" data-en="Disconnected">ØºÙŠØ± Ù…ØªØµÙ„</div>
                <div class="balance-text" id="balanceText"></div>
            </div>
        </div>
        <button id="netBtn" class="action-btn" onclick="toggleNetwork()" data-ar="Ø§Ø®ØªØ± Ø´Ø¨ÙƒØ©" data-en="Select Network">Testnet</button>
        <button id="connectBtn" class="action-btn" onclick="piConnect()" data-ar="Ø§ØªØµØ§Ù„" data-en="Connect">Ø§ØªØµØ§Ù„</button>
        <button id="ordersBtn" class="action-btn" style="display:none;" onclick="openOrdersModal()" data-ar="Ø·Ù„Ø¨Ø§ØªÙŠ" data-en="My Orders">
            <i class="fa-solid fa-list-check"></i> Ø·Ù„Ø¨Ø§ØªÙŠ
        </button>
        <button id="verifyBtn" class="action-btn" style="display:none;" onclick="openVerificationModal()" data-ar="ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø³Ø§Ø¨" data-en="Verify Account">
            <i class="fa-solid fa-shield-halved"></i> ØªÙˆØ«ÙŠÙ‚
        </button>
        <button id="sellBtn" class="action-btn" style="display:none;" onclick="openAddProductModal()" data-ar="Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬" data-en="Add Product">
            <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
        </button>
        <button id="logoutBtn" class="action-btn" style="display:none;" onclick="piLogout()" data-ar="Ø®Ø±ÙˆØ¬" data-en="Logout">Ø®Ø±ÙˆØ¬</button>
        <button id="langToggleTop" class="action-btn" onclick="toggleLanguage()">EN</button>
    </div>
</div>

<div class="container">
    <div class="controls">
        <div class="search-container">
            <input type="text" id="search-input" data-ar="Ø§Ø¨Ø­Ø« Ø¨Ø°ÙƒØ§Ø¡..." data-en="Search smart..." placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø°ÙƒØ§Ø¡...">
            <button class="action-btn" onclick="handleAISearch()" data-ar="Ø¨Ø­Ø«" data-en="Search"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>
        <div class="sort-container">
            <label data-ar="ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:" data-en="Sort By:">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:</label>
            <select id="sortSelect" onchange="handleSortChange(this.value)">
                <option value="default" data-ar="Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹" data-en="Newest First">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
                <option value="rating_desc" data-ar="Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹" data-en="Top Rated">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</option>
                <option value="price_asc" data-ar="Ø§Ù„Ø£Ù‚Ù„ Ø³Ø¹Ø±Ø§Ù‹" data-en="Lowest Price">Ø§Ù„Ø£Ù‚Ù„ Ø³Ø¹Ø±Ø§Ù‹</option>
                <option value="price_desc" data-ar="Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø±Ø§Ù‹" data-en="Highest Price">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø±Ø§Ù‹</option>
            </select>
        </div>
    </div>
    <div class="main-layout">
        <div class="products-area">
            <div id="cats" class="category-bar"></div>
            <div id="productList"></div>
        </div>
        <div class="sidebar-area">
            <div class="sidebar-panel">
                <h3 data-ar="Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚" data-en="Shopping Cart">Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
                <div id="cartArea"></div>
                <div id="cartTotal">
                    <div class="total-pi" data-ar="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0.00 Pi" data-en="Total: 0.00 Pi">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0.00 Pi</div>
                    <div class="total-usd" data-ar="(~ $0.00)" data-en="(~ $0.00)">(~ $0.00)</div>
                </div>
                <button id="checkoutBtn" class="action-btn" onclick="piCheckout()" disabled data-ar="Ø¯ÙØ¹ (Testnet)" data-en="Pay (Testnet)">Ø¯ÙØ¹ (Testnet)</button>
            </div>
            
            <div class="sidebar-panel" id="sellerAnalyzerPanel" style="display:none;">
                <h3 data-ar="â­ Ù…Ø­Ù„Ù„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¨Ø§Ø¦Ø¹" data-en="â­ Seller Performance Analyzer">â­ Ù…Ø­Ù„Ù„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¨Ø§Ø¦Ø¹</h3>
                <div id="sellerAnalysisResult" class="analyzer-result">
                    <i class="fa-solid fa-spinner fa-spin"></i> <span data-ar="Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„..." data-en="Analyzing history...">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...</span>
                </div>
            </div>

            <div class="sidebar-panel">
                <h3 data-ar="ğŸ“¦ Ù…Ø¯ÙŠØ± Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø°ÙƒÙŠ" data-en="ğŸ“¦ Smart Shipping Manager">ğŸ“¦ Ù…Ø¯ÙŠØ± Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø°ÙƒÙŠ</h3>
                <div class="form-group">
                    <label for="trackingInput" data-ar="Ø±Ù‚Ù… ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø©:" data-en="Tracking Number:">Ø±Ù‚Ù… ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø©:</label>
                    <input type="text" id="trackingInput" value="TRK-9001" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹">
                </div>
                <button class="action-btn" onclick="startSmartShipping()" style="width:100%;background:var(--accent);" data-ar="Ø§Ø­Ø³Ø¨ ÙˆØªØªØ¨Ø¹" data-en="Calculate & Track">Ø§Ø­Ø³Ø¨ ÙˆØªØªØ¨Ø¹</button>
                <div id="shippingResult" class="tracking-status">
                    <span data-ar="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹ Ù„Ø­Ø³Ø§Ø¨ Ø£ÙØ¶Ù„ Ø´Ø±ÙƒØ© Ø´Ø­Ù†" data-en="Enter tracking number to calculate best carrier">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹ Ù„Ø­Ø³Ø§Ø¨ Ø£ÙØ¶Ù„ Ø´Ø±ÙƒØ© Ø´Ø­Ù†</span>
                </div>
            </div>
            
            <div class="sidebar-panel">
                <h3 data-ar="Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" data-en="Transaction Log">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
                <div id="txLog"></div>
                <div class="log-controls">
                    <button id="clearLogsBtn" class="action-btn" onclick="clearLogs()"><i class="fa-solid fa-broom"></i> <span data-ar="Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„" data-en="Clear Log">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</span></button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="logyFloatingBtn" onclick="openLogyModal()" title="Smart Messaging System"><i class="fa-solid fa-comments"></i></div>
<div id="disputeFloatingBtn" onclick="openDisputeModal()" title="Dispute Center"><i class="fa-solid fa-scale-balanced"></i></div>


<div id="logyModal" class="modal">
  <div class="modal-content" style="max-width:600px;height:80vh;display:flex;flex-direction:column;padding:22px;">
    <button class="modal-close" onclick="closeLogyModal()">&times;</button>
    <div style="font-size:22px;color:var(--primary);margin-bottom:9px;">
      <i class="fa-solid fa-comments"></i> <span data-ar="ğŸ’¬ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ" data-en="ğŸ’¬ Smart Messaging System">ğŸ’¬ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ</span>
    </div>
    <div id="logyAiChat" style="background:var(--background);color:var(--text-light);flex:1;overflow-y:auto;padding:15px 10px;font-size:18px;border-radius:var(--radius);margin-bottom:7px;"></div>
    <div style="display:flex;gap:10px;">
      <input type="text" id="logyInput" data-ar="Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ø§Ù‹ØŒ Ø£Ùˆ Ø§Ø·Ù„Ø¨ 'Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¨Ø´Ø±ÙŠ' Ø£Ùˆ 'ØªØ±Ø¬Ù…'" data-en="Ask a question, or ask for 'Human Support' or 'Translate'" placeholder="Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ø§Ù‹ØŒ Ø£Ùˆ Ø§Ø·Ù„Ø¨ 'Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¨Ø´Ø±ÙŠ' Ø£Ùˆ 'ØªØ±Ø¬Ù…'" style="flex:1;padding:11px 8px;border-radius:var(--radius);border:1px solid var(--secondary);font-size:17px;background:var(--background-dark);color:white;">
      <button id="logySend" onclick="sendLogyMessage()" style="padding:10px 16px;background:var(--success);color:#fff;border-radius:var(--radius);border:none;cursor:pointer;font-size:16px;"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<div id="ordersModal" class="modal">
    <div class="modal-content" style="max-width:650px;">
        <button class="modal-close" onclick="closeOrdersModal()">&times;</button>
        <h2 style="color:var(--primary);margin-bottom:15px;"><i class="fa-solid fa-list-check"></i> <span data-ar="ğŸ“‹ Ù…Ø¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ø·Ù„Ø¨Ø§ØªÙŠ" data-en="ğŸ“‹ Smart Order Manager - My Orders">ğŸ“‹ Ù…Ø¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø°ÙƒÙŠ - Ø·Ù„Ø¨Ø§ØªÙŠ</span></h2>
        
        <div id="ordersList" style="max-height: 400px; overflow-y: auto; padding-right: 5px;">
            </div>
        <div id="noOrdersMessage" style="text-align:center;color:var(--text-muted);margin-top:20px;display:none;">
            <span data-ar="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹." data-en="No current orders.">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</span>
        </div>
    </div>
</div>

<div id="disputeModal" class="modal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeDisputeModal()">&times;</button>
        <h2 style="color:var(--primary);margin-bottom:15px;"><i class="fa-solid fa-scale-balanced"></i> <span data-ar="âš–ï¸ Ù…Ø±ÙƒØ² Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ" data-en="âš–ï¸ Auto Dispute Resolution Center">âš–ï¸ Ù…Ø±ÙƒØ² Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span></h2>
        
        <h4 style="color:var(--text-light);" data-ar="Ø³Ø¬Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©" data-en="Current Dispute Log">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
        <div id="disputeList" style="max-height: 150px; overflow-y: auto; margin-bottom: 15px; border: 1px solid #333; border-radius: 4px;"></div>
        
        <h4 style="color:var(--text-light);margin-top:20px;" data-ar="ØªÙ‚Ø¯ÙŠÙ… Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©" data-en="Submit New Complaint">ØªÙ‚Ø¯ÙŠÙ… Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©</h4>
        <form id="disputeForm" onsubmit="submitDispute(event)">
            <div class="form-group">
                <label data-ar="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø«Ø§Ù„: ORD-100)" data-en="Order ID (e.g. ORD-100)">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø«Ø§Ù„: ORD-100)</label>
                <input type="text" id="disputeOrderId" required value="ORD-101">
            </div>
            <div class="form-group">
                <label data-ar="Ù…Ù„Ø®Øµ Ø§Ù„Ø´ÙƒÙˆÙ‰" data-en="Complaint Summary">Ù…Ù„Ø®Øµ Ø§Ù„Ø´ÙƒÙˆÙ‰</label>
                <textarea id="disputeComplaint" required placeholder="ØªÙ„Ù‚ÙŠØª Ø§Ù„Ù…Ù†ØªØ¬ ØªØ§Ù„ÙØ§Ù‹..."></textarea>
            </div>
            <button type="submit" class="action-btn" style="width:100%;padding:12px;background:var(--danger);" data-ar="ØªØ­Ù„ÙŠÙ„ ÙˆØ­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹" data-en="Analyze & Resolve Dispute">
                <i class="fa-solid fa-gavel"></i> ØªØ­Ù„ÙŠÙ„ ÙˆØ­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹
            </button>
        </form>
    </div>
</div>
<div id="verificationModal" class="modal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeVerificationModal()">&times;</button>
        <h2 style="color:var(--primary);margin-bottom:15px;"><i class="fa-solid fa-shield-halved"></i> <span data-ar="ØªÙˆØ«ÙŠÙ‚ Ø­Ø³Ø§Ø¨Ùƒ" data-en="Verify Your Account">ØªÙˆØ«ÙŠÙ‚ Ø­Ø³Ø§Ø¨Ùƒ</span></h2>
        
        <div style="background:var(--accent);color:white;padding:12px;border-radius:var(--radius);margin-bottom:15px;font-size:14px;">
            <span data-ar="âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù…Ù† Pi Network Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª" data-en="âš ï¸ Must be verified by Pi Network to add products">âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù…Ù† Pi Network Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª</span>
        </div>
        
        <div class="verification-steps">
            <div class="verification-step" id="step1">
                <div class="step-number">1</div>
                <div>
                    <h4 style="color:var(--primary);margin-bottom:3px;" data-ar="Ø§ØªØµØ§Ù„ Pi Network" data-en="Pi Network Connection">Ø§ØªØµØ§Ù„ Pi Network</h4>
                    <p style="color:var(--text-muted);font-size:13px;" data-ar="Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø­Ø³Ø§Ø¨Ùƒ" data-en="Connect your account">Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø­Ø³Ø§Ø¨Ùƒ</p>
                </div>
            </div>
            
            <div class="verification-step" id="step2">
                <div class="step-number">2</div>
                <div>
                    <h4 style="color:var(--primary);margin-bottom:3px;" data-ar="Ø§Ù„ØªØ­Ù‚Ù‚ KYC" data-en="KYC Verification">Ø§Ù„ØªØ­Ù‚Ù‚ KYC</h4>
                    <p style="color:var(--text-muted);font-size:13px;" data-ar="Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØªÙƒ" data-en="Verify your identity">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØªÙƒ</p>
                </div>
            </div>
            
            <div class="verification-step" id="step3">
                <div class="step-number">3</div>
                <div>
                    <h4 style="color:var(--primary);margin-bottom:3px;" data-ar="Ù…Ø±Ø§Ø¬Ø¹Ø© AI" data-en="AI Review">Ù…Ø±Ø§Ø¬Ø¹Ø© AI</h4>
                    <p style="color:var(--text-muted);font-size:13px;" data-ar="ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ" data-en="Auto check">ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ</p>
                </div>
            </div>
            
            <div class="verification-step" id="step4">
                <div class="step-number">4</div>
                <div>
                    <h4 style="color:var(--primary);margin-bottom:3px;" data-ar="Ù…ÙˆØ§ÙÙ‚Ø©" data-en="Approval">Ù…ÙˆØ§ÙÙ‚Ø©</h4>
                    <p style="color:var(--text-muted);font-size:13px;" data-ar="Ø­Ø³Ø§Ø¨ Ù…ÙˆØ«Ù‚" data-en="Verified account">Ø­Ø³Ø§Ø¨ Ù…ÙˆØ«Ù‚</p>
                </div>
            </div>
        </div>
        
        <button id="startVerificationBtn" class="action-btn" onclick="startVerification()" style="width:100%;margin-top:15px;padding:12px;background:var(--success);" data-ar="Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙˆØ«ÙŠÙ‚" data-en="Start Verification">
            <i class="fa-solid fa-shield-halved"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙˆØ«ÙŠÙ‚
        </button>
    </div>
</div>
<div id="addProductModal" class="modal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeAddProductModal()">&times;</button>
        <h2 style="color:var(--primary);margin-bottom:15px;" data-ar="Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯" data-en="Add New Product">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
        
        <div id="productAnalysisStatus" class="analyzer-result" style="display:none;margin-bottom:15px;padding:10px;border-left:3px solid var(--accent);">
            <i class="fa-solid fa-flask"></i> <span data-ar="Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…Ù†ØªØ¬..." data-en="Analyzing product specs...">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…Ù†ØªØ¬...</span>
        </div>

        <form id="productForm" onsubmit="submitProduct(event)">
            <div class="form-group">
                <label data-ar="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ø¹Ø±Ø¨ÙŠ) *" data-en="Product Name (Arabic) *">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ø¹Ø±Ø¨ÙŠ) *</label>
                <input type="text" id="productNameAr" required>
            </div>
            
            <div class="form-group">
                <label data-ar="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (English) *" data-en="Product Name (English) *">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (English) *</label>
                <input type="text" id="productNameEn" required>
            </div>
            
            <div class="form-group">
                <label data-ar="Ø§Ù„ÙØ¦Ø© *" data-en="Category *">Ø§Ù„ÙØ¦Ø© *</label>
                <select id="productCategory" required>
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                    <option value="cars" data-ar="Ø³ÙŠØ§Ø±Ø§Øª" data-en="Cars">Ø³ÙŠØ§Ø±Ø§Øª</option>
                    <option value="real" data-ar="Ø¹Ù‚Ø§Ø±Ø§Øª" data-en="Real Estate">Ø¹Ù‚Ø§Ø±Ø§Øª</option>
                    <option value="electronics" data-ar="Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª" data-en="Electronics">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                    <option value="fashion" data-ar="Ø£Ø²ÙŠØ§Ø¡" data-en="Fashion">Ø£Ø²ÙŠØ§Ø¡</option>
                    <option value="home" data-ar="Ù…Ù†Ø²Ù„" data-en="Home">Ù…Ù†Ø²Ù„</option>
                    <option value="services" data-ar="Ø®Ø¯Ù…Ø§Øª" data-en="Services">Ø®Ø¯Ù…Ø§Øª</option>
                </select>
            </div>
            
            <div class="form-group">
                <label data-ar="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­ (Pi) *" data-en="Suggested Price (Pi) *">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­ (Pi) *</label>
                <input type="number" id="productPrice" step="0.01" min="0.01" required>
            </div>
            
            <div class="form-group">
                <label data-ar="Ø§Ù„ÙˆØµÙ (Ø¹Ø±Ø¨ÙŠ) *" data-en="Description (Arabic) *">Ø§Ù„ÙˆØµÙ (Ø¹Ø±Ø¨ÙŠ) *</label>
                <textarea id="productDescAr" required></textarea>
            </div>
            
            <div class="form-group">
                <label data-ar="Ø§Ù„ÙˆØµÙ (English) *" data-en="Description (English) *">Ø§Ù„ÙˆØµÙ (English) *</label>
                <textarea id="productDescEn" required></textarea>
            </div>
            
            <div class="form-group">
                <label data-ar="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" data-en="Image URL">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
                <input type="url" id="productImage" placeholder="https://example.com/image.jpg" value="https://placehold.co/350x120/1A2E44/FFD400?text=New+Item">
            </div>
            
            <button type="submit" class="action-btn" id="submitProductBtn" style="width:100%;padding:12px;background:var(--success);" data-ar="Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬" data-en="Add Product">
                <i class="fa-solid fa-check"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
            </button>
        </form>
    </div>
</div>
<div id="productModal" class="modal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeProductModal()">&times;</button>
        <div class="product-modal-layout">
            <div class="product-modal-image-col" id="modalImage">
                <!-- Image will be inserted here by JS -->
            </div>
            <div class="product-modal-details-col">
                <div id="modalTitle"></div>
                <div id="modalRating"></div>
                <div id="modalDesc"></div>
                <div id="modalPrice"></div>
                <button class="action-btn add-to-cart-btn" onclick="addModalToCart()">
                    <i class="fa-solid fa-cart-plus"></i> 
                    <span data-ar="Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©" data-en="Add to Cart">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// ============================================
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (DATA)
// ============================================
const PRODUCTS = [
    {id:'p1',cat:'cars', name_ar:'ØªÙˆÙŠÙˆØªØ§ ÙƒÙˆØ±ÙˆÙ„Ø§ 2018', name_en:'Toyota Corolla 2018', desc_ar:'Ø­Ø§Ù„Ø© Ù…Ù…ØªØ§Ø²Ø© â€¢ 120 Ø£Ù„Ù ÙƒÙ…', desc_en:'Excellent condition â€¢ 120k km', price:120000, img:'https://placehold.co/350x120/FFD400/0D1B2A?text=Corolla', rating:4.3, verified:true},
    {id:'p2',cat:'electronics', name_ar:'Ù‡Ø§ØªÙ Pi Ø§Ù„Ø°ÙƒÙŠ', name_en:'Pi Smart Phone', desc_ar:'5G â€¢ Ø´Ø§Ø´Ø© OLED â€¢ ÙƒØ§Ù…ÙŠØ±Ø§ AI', desc_en:'5G â€¢ OLED Display â€¢ AI Camera', price:85.5, img:'https://placehold.co/350x120/0D1B2A/FFD400?text=Phone', rating:4.7, is_ai_pick:true, verified:true},
    {id:'p3',cat:'electronics', name_ar:'Ø³Ø§Ø¹Ø© Pi', name_en:'Pi Smart Watch', desc_ar:'Ù„ÙŠØ§Ù‚Ø© â€¢ 7 Ø£ÙŠØ§Ù… Ø¨Ø·Ø§Ø±ÙŠØ©', desc_en:'Fitness tracker â€¢ 7-day battery', price:12.75, img:'https://placehold.co/350x120/1A2E44/FFD400?text=Watch', rating:4.1, verified:true},
    {id:'p4',cat:'real', name_ar:'Ø´Ù‚Ø© 120Ù… Ø¨Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ', name_en:'120m Apartment in Zamalek', desc_ar:'Ù…ÙØ±ÙˆØ´Ø© â€¢ Ù…ÙˆÙ‚Ø¹ Ù…Ù…ÙŠØ²', desc_en:'Fully Furnished â€¢ Prime location', price:21000, img:'https://placehold.co/350x120/08121a/FFD400?text=Apartment', rating:4.6, verified:true},
    {id:'p5',cat:'fashion', name_ar:'Ø¬Ø§ÙƒÙŠØª Ø¬Ù„Ø¯', name_en:'Leather Jacket', desc_ar:'Ø¬Ù„Ø¯ Ø·Ø¨ÙŠØ¹ÙŠ â€¢ Ø¬Ø¯ÙŠØ¯', desc_en:'Genuine leather â€¢ Brand New', price:120, img:'https://placehold.co/350x120/1A2E44/FFD400?text=Jacket', rating:4.0, verified:true},
    {id:'p6',cat:'home', name_ar:'Ø·Ù‚Ù… ÙƒÙ†Ø¨Ø© 3 Ù…Ù‚Ø§Ø¹Ø¯', name_en:'3-Seater Sofa Set', desc_ar:'Ù‚Ù…Ø§Ø´ ÙØ§Ø®Ø± â€¢ Ø¶Ù…Ø§Ù† Ø³Ù†Ø©', desc_en:'Premium fabric â€¢ 1yr warranty', price:450, img:'https://placehold.co/350x120/0D1B2A/FFD400?text=Sofa', rating:4.2, verified:true},
    {id:'p7',cat:'services', name_ar:'ØªØµÙ…ÙŠÙ… Ù…ÙˆÙ‚Ø¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', name_en:'Web Design Service', desc_ar:'ØªØµÙ…ÙŠÙ… ÙƒØ§Ù…Ù„ â€¢ Ø³Ù†Ø© Ø¯Ø¹Ù… Ù…Ø¬Ø§Ù†ÙŠØ©', desc_en:'Full design â€¢ 1yr free support', price:1500, img:'https://placehold.co/350x120/FFD400/0D1B2F?text=Web+Design', rating:4.9, is_ai_pick:true, verified:true},
    {id:'p8',cat:'cars', name_ar:'Ø¯Ø±Ø§Ø¬Ø© Ù†Ø§Ø±ÙŠØ© Ø±ÙŠØ§Ø¶ÙŠØ©', name_en:'Sport Motorcycle', desc_ar:'2023 â€¢ 1500 ÙƒÙ…', desc_en:'2023 Model â€¢ 1500 km', price:9500, img:'https://placehold.co/350x120/1A2E44/FFD400?text=Bike', rating:4.4, verified:true},
    {id:'p9',cat:'electronics', name_ar:'Ø´Ø§Ø´Ø© 4K Ø°ÙƒÙŠØ©', name_en:'4K Smart TV', desc_ar:'55 Ø¨ÙˆØµØ© â€¢ Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯', desc_en:'55 inch â€¢ Android OS', price:320, img:'https://placehold.co/350x120/0D1B2A/FFD400?text=Smart+TV', rating:4.5, verified:true},
    {id:'p10',cat:'real', name_ar:'ÙÙŠÙ„Ø§ ÙÙŠ Ø§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„Ø®Ø§Ù…Ø³', name_en:'Villa in New Cairo', desc_ar:'Ù…Ø³Ø§Ø­Ø© 500Ù… â€¢ ØªØ´Ø·ÙŠØ¨ ÙØ§Ø®Ø±', desc_en:'500m area â€¢ Luxury finish', price:550000, img:'https://placehold.co/350x120/08121a/FFD400?text=Villa', rating:4.8, verified:true}
];

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© 
let MOCK_DISPUTES = [
    {id:'D001', orderId:'ORD-100', complaint:'ØªØ£Ø®Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù…Ø¯Ø© 3 Ø£ÙŠØ§Ù…', status:'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„', result:null, resolved:false},
    {id:'D002', orderId:'ORD-99', complaint:'Ù„Ù… ÙŠØµÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø¹Ø¯', status:'Ù…Ø±ÙÙˆØ¶', result:'Seller provided valid tracking', resolved:true}
];

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
let MOCK_ORDERS = [
    {id:'ORD-100', total: 85.5, status_ar:'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„', status_en:'Delivered', date: new Date(Date.now() - 50000000).toLocaleString(), items:[{name:'Ù‡Ø§ØªÙ Pi Ø§Ù„Ø°ÙƒÙŠ', qty:1, price: 85.5}]}
];
const ORDER_STATUSES_AR = ['Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²', 'ØªÙ… Ø§Ù„Ø´Ø­Ù†', 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„'];
const ORDER_STATUSES_EN = ['Pending', 'Processing', 'Shipped', 'Delivered'];

let MOCK_SELLER_HISTORY = {
    transactions: 25,
    successful_rate: 0.96,
    disputes_resolved: 5,
    ai_rating: 4.85,
    status_ar: 'Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ù…ÙˆØµÙ‰ Ø¨Ù‡',
    status_en: 'Recommended Seller'
};

const CATEGORIES = [
    {key:'all',icon:'fa-th-large',ar:'Ø§Ù„ÙƒÙ„',en:'All'},
    {key:'cars',icon:'fa-car-side',ar:'Ø³ÙŠØ§Ø±Ø§Øª',en:'Cars'},
    {key:'real',icon:'fa-building',ar:'Ø¹Ù‚Ø§Ø±Ø§Øª',en:'Real Estate'},
    {key:'electronics',icon:'fa-microchip',ar:'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª',en:'Electronics'},
    {key:'fashion',icon:'fa-tshirt',ar:'Ø£Ø²ÙŠØ§Ø¡',en:'Fashion'},
    {key:'home',icon:'fa-house-chimney',ar:'Ù…Ù†Ø²Ù„',en:'Home'},
    {key:'services',icon:'fa-hands',ar:'Ø®Ø¯Ù…Ø§Øª',en:'Services'}
];

let currentFilter = 'all';
let currentSort = 'default';
let cart = [];
let lang = 'ar';
let piConnected = false;
let userVerified = false;
let network = 'Testnet';
let currentProductId = null;
let logyConversation = [];

// ============================================
// Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„ØºØ© (TRANSLATE)
// ============================================
function translateUI() {
    document.querySelectorAll('[data-ar],[data-en]').forEach(el => {
        let txt = lang === 'ar' ? el.getAttribute('data-ar') : el.getAttribute('data-en');
        if (!txt) return;
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = txt;
        else if (el.tagName === 'OPTION' || el.tagName === 'LABEL' || el.tagName === 'BUTTON' || el.tagName === 'SPAN' || el.tagName === 'H2' || el.tagName === 'H3' || el.tagName === 'H4' || el.tagName === 'P') el.textContent = txt;
    });
}

window.toggleLanguage = function() {
    lang = lang === 'ar' ? 'en' : 'ar';
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    translateUI();
    updateUserBar();
    renderCategories();
    renderProducts(currentFilter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.cat === currentFilter));
    renderCart();
    renderDisputes();
    analyzeSeller(); // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹
    logEvent(lang === 'ar' ? 'ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ù„Ù€ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Language changed to English');
}

// ============================================
// Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (USER BAR)
// ============================================
function updateUserBar() {
    document.getElementById('usernameText').textContent = piConnected ? (lang === 'ar' ? 'Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØµÙ„' : 'User Connected') : (lang === 'ar' ? 'ØºÙŠØ± Ù…ØªØµÙ„' : 'Disconnected');
    document.getElementById('statusIcon').className = 'fa-solid ' + (piConnected ? 'fa-circle-check' : 'fa-circle-xmark');
    document.getElementById('balanceText').textContent = piConnected ? (lang === 'ar' ? 'Ø§Ù„Ø±ØµÙŠØ¯: ' : 'Balance: ') + '1000 Pi' : '';
    document.getElementById('connectBtn').style.display = piConnected ? 'none' : 'inline-block';
    document.getElementById('logoutBtn').style.display = piConnected ? 'inline-block' : 'none';
    document.getElementById('verifyBtn').style.display = (piConnected && !userVerified) ? 'inline-block' : 'none';
    document.getElementById('sellBtn').style.display = (piConnected && userVerified) ? 'inline-block' : 'none';
    document.getElementById('ordersBtn').style.display = piConnected ? 'inline-block' : 'none'; // Ø²Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    document.getElementById('netBtn').textContent = network;
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ù…Ø­Ù„Ù„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„Ø§Ù‹ ÙˆÙ…ÙˆØ«Ù‚Ø§Ù‹
    document.getElementById('sellerAnalyzerPanel').style.display = (piConnected && userVerified) ? 'block' : 'none';
    if (piConnected && userVerified) {
        analyzeSeller();
    }
}

// ============================================
// Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ÙˆØ§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙØ±Ø² (CATEGORIES & SORT)
// ============================================
function renderCategories() {
    document.getElementById('cats').innerHTML = CATEGORIES.map(cat =>
        `<div class="cat${cat.key === currentFilter ? ' active' : ''}" onclick="handleCategoryFilter('${cat.key}')"><i class="fa-solid ${cat.icon}"></i> ${lang === 'ar' ? cat.ar : cat.en}</div>`
    ).join('');
}

window.handleCategoryFilter = function(category) {
    currentFilter = category;
    renderCategories();
    renderProducts(category === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.cat === category));
    logEvent((lang === 'ar' ? 'ØªØºÙŠÙŠØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø¥Ù„Ù‰: ' : 'Filter: ') + (lang === 'ar' ? CATEGORIES.find(c => c.key === category).ar : CATEGORIES.find(c => c.key === category).en));
}

window.handleSortChange = function(sortBy) {
    currentSort = sortBy;
    const filtered = currentFilter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.cat === currentFilter);
    renderProducts(filtered);
}

window.handleAISearch = function() {
    const term = document.getElementById('search-input').value.trim();
    if (!term) {
        renderProducts(currentFilter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.cat === currentFilter));
        logEvent(lang === 'ar' ? 'Ø¨Ø­Ø« ÙØ§Ø±Øº' : 'Empty search');
        return;
    }
    const filtered = PRODUCTS.filter(p =>
        (lang === 'ar' ? p.name_ar : p.name_en).toLowerCase().includes(term.toLowerCase()) ||
        (lang === 'ar' ? p.desc_ar : p.desc_en).toLowerCase().includes(term.toLowerCase())
    );
    renderProducts(filtered);
    logEvent((lang === 'ar' ? 'Ø¨Ø­Ø« Ø¹Ù†: ' : 'Search for: ') + term);
}

function sortProducts(products, sortBy) {
    return products.slice().sort((a, b) => {
        switch (sortBy) {
            case 'rating_desc': return b.rating - a.rating;
            case 'price_asc': return a.price - b.price;
            case 'price_desc': return b.price - a.price;
            default: return b.id.localeCompare(a.id);
        }
    });
}

// ============================================
// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØªÙØ§ØµÙŠÙ„Ù‡Ø§ (PRODUCTS & MODAL)
// ============================================
function renderProducts(products) {
    const productList = document.getElementById('productList');
    if (products.length === 0) {
        productList.innerHTML = '<div style="text-align:center;color:#FFD400;margin:14px">' + (lang === 'ar' ? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª' : 'No products found') + '</div>';
        return;
    }
    productList.innerHTML = sortProducts(products, currentSort).map(p => `
        <div class="product">
            ${p.verified ? '<div class="verified-badge"><i class="fa-solid fa-shield-halved"></i></div>' : ''}
            ${p.is_ai_pick ? '<div class="ai-badge">AI Pick</div>' : ''}
            <img src="${p.img}" alt="${lang === 'ar' ? p.name_ar : p.name_en}" onclick="openProductModal('${p.id}')">
            <div class="product-content">
                <div class="title">${lang === 'ar' ? p.name_ar : p.name_en}</div>
                <div class="desc">${lang === 'ar' ? p.desc_ar : p.desc_en}</div>
                <div class="price-row">
                    <div class="price">${p.price.toLocaleString()} Pi</div>
                    <div class="seller-rating">${p.rating} <i class="fa-solid fa-star"></i></div>
                </div>
                <button class="action-btn" onclick="addToCart('${p.id}')" style="width:100%;background:var(--success);margin-top:5px;"><i class="fa-solid fa-cart-plus"></i> ${(lang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©' : 'Add to Cart')}</button>
            </div>
        </div>`).join('');
}

window.openProductModal = function(id) {
    document.getElementById('productModal').style.display = 'flex';
    currentProductId = id;
    const prod = PRODUCTS.find(p => p.id === id);
    document.getElementById('modalImage').innerHTML = `<img src="${prod.img}" alt="${lang === 'ar' ? prod.name_ar : prod.name_en}">`;
    document.getElementById('modalTitle').textContent = lang === 'ar' ? prod.name_ar : prod.name_en;
    document.getElementById('modalDesc').textContent = lang === 'ar' ? prod.desc_ar : prod.desc_en;
    document.getElementById('modalPrice').textContent = prod.price.toLocaleString() + ' Pi';
    document.getElementById('modalRating').innerHTML = prod.rating + ' <i class="fa-solid fa-star"></i>';
}

window.closeProductModal = function() { document.getElementById('productModal').style.display = 'none'; currentProductId = null; }
window.addModalToCart = function() { if (currentProductId) { addToCart(currentProductId); closeProductModal(); } }

// ============================================
// Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙˆØ§Ù„Ø¯ÙØ¹ (CART & CHECKOUT)
// ============================================
function addToCart(id) {
    const prod = PRODUCTS.find(p => p.id === id);
    if (!prod) return;
    const exists = cart.find(item => item.id === id);
    if (exists) {
        exists.qty += 1;
    } else {
        cart.push({ ...prod, qty: 1 });
    }
    renderCart();
    logEvent((lang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©: ' : 'Added to cart: ') + (lang === 'ar' ? prod.name_ar : prod.name_en));
}

function renderCart() {
    const area = document.getElementById('cartArea');
    let total = 0;
    if (cart.length === 0) {
        area.innerHTML = '<div style="text-align:center;color:#FFD400;">' + (lang === 'ar' ? 'Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©' : 'Your cart is empty') + '</div>';
    } else {
        area.innerHTML = cart.map(item => `
            <div class="cart-row">
                <span style="flex-grow:1">${lang === 'ar' ? item.name_ar : item.name_en} <span class="cart-qty">(${item.qty})</span></span>
                <span style="color:var(--success);margin-inline-end:10px;">${(item.price * item.qty).toLocaleString()} Pi</span>
                <button class="action-btn" style="padding:3px 8px;" onclick="updateCartQty('${item.id}',-1)">-</button>
                <button class="action-btn" style="padding:3px 8px;" onclick="updateCartQty('${item.id}',1)">+</button>
                <button class="action-btn" style="background:var(--danger-dark);padding:3px 8px;" onclick="removeCartItem('${item.id}')"><i class="fa-solid fa-trash"></i></button>
            </div>
        `).join('');
        total = cart.reduce((sum, it) => sum + it.price * it.qty, 0);
    }
    document.querySelector('#cartTotal .total-pi').textContent = (lang === 'ar' ? 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ' : 'Total: ') + total.toLocaleString() + ' Pi';
    document.querySelector('#cartTotal .total-usd').textContent = "(~ $" + (total * 0.00025).toFixed(2) + ")";
    document.getElementById('checkoutBtn').disabled = cart.length === 0;
}

window.updateCartQty = function(id, delta) {
    const item = cart.find(i => i.id === id);
    if (item) {
        item.qty += delta;
        if (item.qty <= 0) {
            removeCartItem(id);
        }
        renderCart();
    }
}

window.removeCartItem = function(id) {
    cart = cart.filter(i => i.id !== id);
    renderCart();
}

// ============================================
// ğŸ“‹ Ù…Ø¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø°ÙƒÙŠ (SMART ORDER MANAGER - NEW)
// ============================================

function createOrder(cartItems, totalPi) {
    const orderId = 'ORD-' + (MOCK_ORDERS.length + 101);
    const orderItems = cartItems.map(item => ({
        name: lang === 'ar' ? item.name_ar : item.name_en,
        qty: item.qty,
        price: item.price
    }));

    const newOrder = {
        id: orderId,
        total: totalPi,
        status_ar: ORDER_STATUSES_AR[0],
        status_en: ORDER_STATUSES_EN[0],
        date: new Date().toLocaleString(lang === 'ar' ? 'ar-EG' : 'en-US'),
        items: orderItems,
        status_index: 0
    };

    MOCK_ORDERS.unshift(newOrder);
    logEvent((lang === 'ar' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: ' : 'New Order Created: ') + orderId);

    // Ø¨Ø¯Ø¡ Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„Ø·Ù„Ø¨
    simulateOrderLifecycle(orderId);
}

function simulateOrderLifecycle(orderId) {
    let order = MOCK_ORDERS.find(o => o.id === orderId);
    if (!order) return;

    let currentStep = order.status_index + 1;

    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù
    const interval = setInterval(() => {
        if (currentStep < ORDER_STATUSES_AR.length) {
            order.status_ar = ORDER_STATUSES_AR[currentStep];
            order.status_en = ORDER_STATUSES_EN[currentStep];
            order.status_index = currentStep;
            logEvent((lang === 'ar' ? 'ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ' : 'Order Status Update ') + orderId + ': ' + (lang === 'ar' ? order.status_ar : order.status_en));
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ
            if (currentStep > 0) {
                 alert((lang === 'ar' ? 'Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ ' : 'Order Notification ') + orderId + ': ' + (lang === 'ar' ? order.status_ar : order.status_en));
            }

            if (document.getElementById('ordersModal').style.display === 'flex') {
                renderOrders(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
            }
            currentStep++;
        } else {
            clearInterval(interval);
        }
    }, 5000); // 5 Ø«ÙˆØ§Ù†ÙŠ Ù„ÙƒÙ„ Ø®Ø·ÙˆØ©
}

window.piCheckout = function() {
    if (cart.length === 0 || !piConnected) return;

    let total = cart.reduce((sum, it) => sum + it.price * it.qty, 0);

    // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¨Ø¯Ø¡ Ø¯ÙˆØ±Ø© Ø§Ù„Ø­ÙŠØ§Ø©
    createOrder(cart, total);

    // 2. Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
    cart = [];
    renderCart();

    // 3. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¯Ø«
    logEvent((lang === 'ar' ? 'ØªÙ… Ø¯ÙØ¹ ' : 'Paid: ') + total.toLocaleString() + ' Pi ' + (lang === 'ar' ? 'Ø¹Ø¨Ø± ' : 'via ') + network);
}

window.openOrdersModal = function() {
    document.getElementById('ordersModal').style.display = 'flex';
    renderOrders();
}
window.closeOrdersModal = function() {
    document.getElementById('ordersModal').style.display = 'none';
}

function renderOrders() {
    const list = document.getElementById('ordersList');
    const noOrders = document.getElementById('noOrdersMessage');

    if (MOCK_ORDERS.length === 0) {
        list.innerHTML = '';
        noOrders.style.display = 'block';
        return;
    }
    noOrders.style.display = 'none';

    list.innerHTML = MOCK_ORDERS.map(order => {
        let statusText = lang === 'ar' ? order.status_ar : order.status_en;
        let color = order.status_index === 3 ? 'var(--success)' : (order.status_index === 0 ? 'var(--primary)' : 'var(--accent)');
        
        const itemsList = order.items.map(item => `
            <li style="font-size:13px;color:var(--text-muted);">${item.name} x ${item.qty} (${item.price.toLocaleString()} Pi)</li>
        `).join('');

        return `
            <div class="order-card">
                <h4>${lang === 'ar' ? 'Ø§Ù„Ø·Ù„Ø¨' : 'Order'} #${order.id}</h4>
                <p style="margin-bottom:5px;font-size:14px;">
                    <span style="font-weight:bold;">${lang === 'ar' ? 'Ø§Ù„Ø­Ø§Ù„Ø©:' : 'Status:'}</span> 
                    <span class="order-status" style="color:${color};">${statusText}</span>
                    <span style="float:${lang === 'ar' ? 'left' : 'right'};font-size:12px;color:var(--text-muted);">${order.date}</span>
                </p>
                <p style="margin:5px 0;">
                    <span style="font-weight:bold;color:var(--primary);">${lang === 'ar' ? 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:' : 'Total:'}</span> ${order.total.toLocaleString()} Pi
                </p>
                <ul style="list-style:none;padding:0;margin:10px 0 0 0;">${itemsList}</ul>
            </div>
        `;
    }).join('');
}


// ============================================
// Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (LOGS)
// ============================================
function logEvent(msg) {
    const log = document.getElementById('txLog');
    const t = new Date().toLocaleTimeString(lang === 'ar' ? 'ar-EG' : 'en-US', { hour: '2-digit', minute: '2-digit' });
    const entry = document.createElement('div');
    entry.innerHTML = `[${t}] ${msg}`;
    entry.style.cssText = 'padding:5px;margin-bottom:3px;background:var(--background-dark);border-radius:4px;font-size:13px;';
    log.prepend(entry);
}

window.clearLogs = function() {
    document.getElementById('txLog').innerHTML = '';
    logEvent(lang === 'ar' ? 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„' : 'Log cleared');
}

// ============================================
// ğŸ“¦ Ù…Ø¯ÙŠØ± Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø°ÙƒÙŠ (SMART SHIPPING)
// ============================================
window.startSmartShipping = function() {
    const trackingNo = document.getElementById('trackingInput').value.trim();
    const resultDiv = document.getElementById('shippingResult');
    
    if (!trackingNo) {
        resultDiv.innerHTML = `<span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--danger')};">` + (lang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØªØªØ¨Ø¹ ØµØ§Ù„Ø­.' : 'Please enter a valid tracking number.') + '</span>';
        return;
    }

    const carriers = ['Aramex', 'DHL', 'FedEx'];
    const chosenCarrier = carriers[Math.floor(Math.random() * carriers.length)];
    const mockCost = (Math.random() * 5 + 2).toFixed(2); 
    const mockStatus = ['In Transit', 'Out for Delivery', 'Delivered'][Math.floor(Math.random() * 3)];

    resultDiv.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ' + (lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø­Ù†Ø©...' : 'Analyzing Shipment...');

    setTimeout(() => {
        resultDiv.innerHTML = `
            <div style="color:var(--text-light);">
                <span style="color:var(--primary);font-weight:bold;">${lang === 'ar' ? 'Ø£ÙØ¶Ù„ Ø´Ø±ÙƒØ© Ø´Ø­Ù†:' : 'Best Carrier:'}</span> ${chosenCarrier}<br>
                <span style="color:var(--primary);font-weight:bold;">${lang === 'ar' ? 'Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:' : 'Estimated Cost:'}</span> ${mockCost} Pi<br>
                <span style="color:var(--primary);font-weight:bold;">${lang === 'ar' ? 'Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø­Ù†Ø©:' : 'Tracking Status:'}</span> ${lang === 'ar' ? getArabicStatus(mockStatus) : mockStatus}
            </div>
            <div style="margin-top:5px;font-style:italic;font-size:12px;color:var(--success);">${lang === 'ar' ? 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„' : 'Customer update sent'}</div>
        `;
        logEvent((lang === 'ar' ? 'ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø© ' : 'Tracked Shipment ') + trackingNo + ': ' + (lang === 'ar' ? getArabicStatus(mockStatus) : mockStatus) + ' via ' + chosenCarrier);
    }, 1500);
}

function getArabicStatus(status) {
    const statusMap = {'In Transit': 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', 'Out for Delivery': 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„', 'Delivered': 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„'};
    return statusMap[status] || status;
}

// ============================================
// âš–ï¸ Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (DISPUTE RESOLUTION)
// ============================================
window.openDisputeModal = function() {
    document.getElementById('disputeModal').style.display = 'flex';
    renderDisputes();
}
window.closeDisputeModal = function() { document.getElementById('disputeModal').style.display = 'none'; }

function renderDisputes() {
    const list = document.getElementById('disputeList');
    if (MOCK_DISPUTES.length === 0) {
        list.innerHTML = '<div style="text-align:center;padding:10px;color:var(--success);">' + (lang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø²Ø§Ø¹Ø§Øª Ø­Ø§Ù„ÙŠØ©.' : 'No active disputes.') + '</div>';
        return;
    }

    list.innerHTML = MOCK_DISPUTES.map(d => `
        <div class="dispute-item">
            <strong>${lang === 'ar' ? 'Ø§Ù„Ø·Ù„Ø¨' : 'Order'}: ${d.orderId}</strong>
            <span style="float:${lang === 'ar' ? 'left' : 'right'};" class="dispute-status ${d.resolved ? 'resolved' : ''}">
                ${lang === 'ar' ? d.status : (d.status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„' ? 'Analyzing' : d.status)}
            </span><br>
            <span style="color:var(--text-muted);font-size:12px;">${lang === 'ar' ? 'Ø§Ù„Ø´ÙƒÙˆÙ‰:' : 'Complaint:'} ${d.complaint.substring(0, 30)}...</span>
        </div>
    `).join('');
}

window.submitDispute = function(e) {
    e.preventDefault();
    const orderId = document.getElementById('disputeOrderId').value.trim();
    const complaint = document.getElementById('disputeComplaint').value.trim();
    
    const refundDecision = Math.random() < 0.5;

    const newId = 'D' + (MOCK_DISPUTES.length + 1).toString().padStart(3, '0');
    
    const decisionText = refundDecision 
        ? (lang === 'ar' ? 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø§Ù„' : 'Refund Approved')
        : (lang === 'ar' ? 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹' : 'Refund Rejected');

    const newDispute = {
        id: newId,
        orderId: orderId,
        complaint: complaint,
        status: decisionText,
        result: refundDecision ? 'Refund issued' : 'Rejected due to insufficient evidence',
        resolved: true
    };

    MOCK_DISPUTES.unshift(newDispute);
    
    setTimeout(() => {
        renderDisputes();
        closeDisputeModal();
        logEvent((lang === 'ar' ? 'Ø­Ù„ Ù†Ø²Ø§Ø¹' : 'Dispute Resolved') + ' ' + orderId + ': ' + decisionText);
        alert(lang === 'ar' ? `Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ø²Ø§Ø¹ ${orderId}: ${decisionText}` : `Dispute ${orderId} Results: ${decisionText}`);
    }, 2000);
}

// ============================================
// â­ Ù…Ø­Ù„Ù„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† (SELLER ANALYZER)
// ============================================
window.analyzeSeller = function() {
    const resultDiv = document.getElementById('sellerAnalysisResult');
    
    resultDiv.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ' + (lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¯Ø§Ø¡...' : 'Analyzing performance history...');

    setTimeout(() => {
        const rating = MOCK_SELLER_HISTORY.ai_rating.toFixed(2);
        const status = lang === 'ar' ? MOCK_SELLER_HISTORY.status_ar : MOCK_SELLER_HISTORY.status_en;

        resultDiv.innerHTML = `
            <div style="color:var(--text-light);">
                <div class="seller-metric">
                    <span>${lang === 'ar' ? 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:' : 'AI Rating:'}</span> 
                    <span style="color:var(--primary);font-weight:bold;">${rating} <i class="fa-solid fa-star"></i></span>
                </div>
                <div class="seller-metric">
                    <span>${lang === 'ar' ? 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­:' : 'Success Rate:'}</span> 
                    <span style="color:var(--success);font-weight:bold;">${(MOCK_SELLER_HISTORY.successful_rate * 100).toFixed(0)}%</span>
                </div>
                <div class="seller-metric">
                    <span>${lang === 'ar' ? 'Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©:' : 'Disputes Resolved:'}</span> 
                    <span style="color:var(--accent);font-weight:bold;">${MOCK_SELLER_HISTORY.disputes_resolved}</span>
                </div>
                <div style="margin-top:10px;font-weight:bold;font-size:15px;text-align:center;">
                    ${lang === 'ar' ? 'ØªÙˆØµÙŠØ© Ø§Ù„Ù…Ø­Ù„Ù„:' : 'Analyzer Recommendation:'} <span style="color:var(--success);">${status}</span>
                </div>
            </div>
        `;
        logEvent(lang === 'ar' ? `ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø¨ØªÙ‚ÙŠÙŠÙ… ${rating}` : `Seller performance analyzed: ${rating} rating`);
    }, 1500);
}

// ============================================
// ğŸ’° Ù…Ø­Ù„Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ Ùˆ âœ… Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
// ============================================
function auditProduct(product) {
    if (product.img.toLowerCase().includes('fail')) {
        return { passed: false, reason_ar: 'Ø§Ù„ØµÙˆØ±Ø© Ù…Ø®Ø§Ù„ÙØ© Ø£Ùˆ ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø©.', reason_en: 'Image is blurry or violates policy.' };
    }
    if (product.desc_ar.includes('Ù…Ù…Ù†ÙˆØ¹') || product.desc_en.includes('prohibited')) {
        return { passed: false, reason_ar: 'Ø§Ù„Ù…Ù†ØªØ¬ Ù…ØµÙ†Ù ÙƒÙ…Ø­Ø¸ÙˆØ±.', reason_en: 'Product classified as prohibited.' };
    }
    if (product.cat === 'electronics' && product.price > 1000) {
        return { passed: false, reason_ar: 'Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± Ù…Ù†Ø·Ù‚ÙŠ Ù„ÙØ¦Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª.', reason_en: 'Illogical price for electronics category.' };
    }
    return { passed: true, reason_ar: 'Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: Ù…ÙˆØ§ØµÙØ§Øª ÙˆØµÙˆØ± Ù…Ù‚Ø¨ÙˆÙ„Ø©.', reason_en: 'Product Auditor: Specs and images accepted.' };
}

function analyzePrice(product) {
    const categoryProducts = PRODUCTS.filter(p => p.cat === product.cat);
    const avgPrice = categoryProducts.length > 0
        ? categoryProducts.reduce((sum, p) => sum + p.price, 0) / categoryProducts.length
        : product.price;

    const suggestedPrice = parseFloat(avgPrice * (Math.random() * 0.2 + 0.9)).toFixed(2); // +/- 10%
    const diffPercent = Math.abs(product.price - suggestedPrice) / suggestedPrice;
    
    if (diffPercent > 0.3) { // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ±Ù‚ Ø£ÙƒØ«Ø± Ù…Ù† 30%
        return {
            warning: true,
            suggestedPrice: suggestedPrice,
            message_ar: `Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­ (${suggestedPrice} Pi) ÙŠØ®ØªÙ„Ù Ø¨Ù†Ø³Ø¨Ø© ÙƒØ¨ÙŠØ±Ø©. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© ØªØ³Ø¹ÙŠØ±Ùƒ.`,
            message_en: `Suggested price (${suggestedPrice} Pi) differs significantly. Please review your pricing.`
        };
    }
    
    return {
        warning: false,
        suggestedPrice: suggestedPrice,
        message_ar: `Ø§Ù„Ø³Ø¹Ø± (${product.price} Pi) Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„.`,
        message_en: `Price (${product.price} Pi) is within the acceptable range.`
    };
}


window.submitProduct = function(e) {
    e.preventDefault();
    document.getElementById('submitProductBtn').disabled = true;

    const newProd = {
        id: 'p' + (PRODUCTS.length + 1),
        cat: document.getElementById('productCategory').value,
        name_ar: document.getElementById('productNameAr').value,
        name_en: document.getElementById('productNameEn').value,
        desc_ar: document.getElementById('productDescAr').value,
        desc_en: document.getElementById('productDescEn').value,
        price: parseFloat(document.getElementById('productPrice').value),
        img: document.getElementById('productImage').value,
        rating: 5.0,
        verified: true
    };

    const statusDiv = document.getElementById('productAnalysisStatus');
    statusDiv.style.display = 'block';
    statusDiv.classList.remove('fail');
    statusDiv.style.borderLeft = `3px solid ${getComputedStyle(document.documentElement).getPropertyValue('--accent')}`;
    statusDiv.innerHTML = `<i class="fa-solid fa-flask fa-spin"></i> ${lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨ÙˆØ§Ø³Ø·Ø© AI...' : 'Analyzing product with AI...'}`;

    // Ø®Ø·ÙˆØ© 1: Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    setTimeout(() => {
        const auditResult = auditProduct(newProd);

        if (!auditResult.passed) {
            statusDiv.classList.add('fail');
            statusDiv.style.borderLeft = `3px solid ${getComputedStyle(document.documentElement).getPropertyValue('--danger')}`;
            statusDiv.innerHTML = `<i class="fa-solid fa-ban"></i> ${lang === 'ar' ? 'Ø±ÙØ¶ Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:' : 'Product Auditor Rejected:'} <span style="color:var(--danger);">${lang === 'ar' ? auditResult.reason_ar : auditResult.reason_en}</span>`;
            document.getElementById('submitProductBtn').disabled = false;
            logEvent(lang === 'ar' ? `Ø±ÙØ¶ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬: ${auditResult.reason_ar}` : `Product Add Rejected: ${auditResult.reason_en}`);
            return;
        }

        // Ø®Ø·ÙˆØ© 2: Ù…Ø­Ù„Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ
        setTimeout(() => {
            const priceResult = analyzePrice(newProd);

            let priceMessage = lang === 'ar' ? priceResult.message_ar : priceResult.message_en;
            let priceIcon = priceResult.warning ? '<i class="fa-solid fa-triangle-exclamation" style="color:var(--primary);"></i>' : '<i class="fa-solid fa-check" style="color:var(--success);"></i>';
            let priceBorder = priceResult.warning ? getComputedStyle(document.documentElement).getPropertyValue('--primary') : getComputedStyle(document.documentElement).getPropertyValue('--success');
            
            statusDiv.style.borderLeft = `3px solid ${priceBorder}`;
            statusDiv.innerHTML = `
                ${priceIcon} ${lang === 'ar' ? 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±:' : 'Price Analysis:'} ${priceMessage}<br>
                <div style="margin-top:5px;">âœ… ${lang === 'ar' ? auditResult.reason_ar : auditProduct.reason_en}</div>
            `;

            if (priceResult.warning) {
                 // Ø¹Ø±Ø¶ ØªØ­Ø°ÙŠØ± Ø¯ÙˆÙ† Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©ØŒ ÙˆÙ„ÙƒÙ† Ø¨ØªØ£Ø®ÙŠØ±
                 alert(lang === 'ar' ? `âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ù…Ø­Ù„Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:\n${priceResult.message_ar}` : `âš ï¸ Price Analyzer Alert:\n${priceResult.message_en}`);
            }

            // Ø®Ø·ÙˆØ© 3: Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            setTimeout(() => {
                PRODUCTS.unshift(newProd);
                renderProducts(currentFilter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.cat === currentFilter));
                closeAddProductModal();
                e.target.reset();
                document.getElementById('submitProductBtn').disabled = false;
                logEvent(lang === 'ar' ? 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØ¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯' : 'New product approved and added');
                alert(lang === 'ar' ? 'ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ¥Ø¶Ø§ÙØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­' : 'Product reviewed and added successfully');
            }, 1000); // ØªØ£Ø®ÙŠØ± Ù„Ø¥Ø¸Ù‡Ø§Ø± Ù†ØªÙŠØ¬Ø© ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±
        }, 1500); // ØªØ£Ø®ÙŠØ± Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ø¹Ø±
    }, 1500); // ØªØ£Ø®ÙŠØ± Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ù…Ù†ØªØ¬
}


// ============================================
// ğŸ’¬ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ (SMART MESSAGING - NEW)
// ============================================
window.openLogyModal = function() { document.getElementById('logyModal').style.display = 'flex'; }
window.closeLogyModal = function() { document.getElementById('logyModal').style.display = 'none'; }

window.sendLogyMessage = function() {
    const input = document.getElementById('logyInput');
    const text = input.value.trim();
    if (!text) return;
    const chat = document.getElementById('logyAiChat');

    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    chat.innerHTML += `<div style="text-align:right;margin-bottom:8px;"><span style="background:var(--accent);padding:5px 10px;border-radius:8px;color:#fff;font-size:16px;">${text}</span></div>`;
    input.value = '';
    
    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ
    const lowerText = text.toLowerCase();
    let replyAr, replyEn;

    // 1. Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¨Ø´Ø±ÙŠ
    if (lowerText.includes('Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¨Ø´Ø±ÙŠ') || lowerText.includes('human support') || lowerText.includes('talk to human')) {
        replyAr = 'ØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¨Ø´Ø±ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ ØºØ¶ÙˆÙ† 5 Ø¯Ù‚Ø§Ø¦Ù‚.';
        replyEn = 'You have been transferred to Human Support. Please wait, a response will follow within 5 minutes.';
    } 
    // 2. Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
    else if (lowerText.includes('Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ÙŠ') || lowerText.includes('order status') || lowerText.includes('my order')) {
        const latestOrder = MOCK_ORDERS[0];
        if (latestOrder) {
            replyAr = `Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø£Ø®ÙŠØ± (${latestOrder.id}) Ù‡ÙŠ: ${latestOrder.status_ar}`;
            replyEn = `Your latest order status (${latestOrder.id}) is: ${latestOrder.status_en}`;
        } else {
            replyAr = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¯ÙØ¹ Ø£ÙˆÙ„Ø§Ù‹.';
            replyEn = 'No orders found. Please ensure payment has been made first.';
        }
    }
    // 3. Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
    else if (lowerText.includes('ØªØ±Ø¬Ù…') || lowerText.includes('translate')) {
        replyAr = 'ØªÙ…Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ù…Ø­Ø§ÙƒØ§Ø©): [Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ForsaleØŒ Ù†Ø£Ù…Ù„ Ø£Ù† ØªØ¬Ø¯ ÙƒÙ„ Ù…Ø§ ØªØ¨Ø­Ø« Ø¹Ù†Ù‡]';
        replyEn = 'Auto-translated (Mock): [Welcome to Forsale, we hope you find everything you are looking for]';
    }
    // 4. Ø§Ù„Ø±Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø§Ù„Ø¹Ø§Ù…Ø©)
    else {
        replyAr = 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø³Ø¤Ø§Ù„Ùƒ. Ø£Ù†Ø§ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø°ÙƒÙŠØŒ ÙˆØ£Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø¨Ø³Ø±Ø¹Ø©. Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Øª Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¨Ø´Ø±ÙŠØ©ØŒ Ø§ÙƒØªØ¨ "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¨Ø´Ø±ÙŠ".';
        replyEn = 'Thank you for asking. I am the Smart Messaging System, and I can answer FAQs quickly. If you need human assistance, type "Human Support".';
    }
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    setTimeout(() => {
        const finalReply = lang === 'ar' ? replyAr : replyEn;
        chat.innerHTML += `<div style="text-align:left;margin-bottom:8px;"><span style="background:var(--background-light);padding:5px 10px;border-radius:8px;color:var(--primary);font-size:16px;"><i class="fa-solid fa-comments"></i> ${finalReply}</span></div>`;
        chat.scrollTop = chat.scrollHeight;
    }, 1200);
}


// ============================================
// Ø¨Ø§Ù‚ÙŠ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (MODAL FUNCTIONS)
// ============================================
window.openVerificationModal = function() { document.getElementById('verificationModal').style.display = 'flex'; }
window.closeVerificationModal = function() { document.getElementById('verificationModal').style.display = 'none'; }

window.startVerification = function() {
    const steps = ['step1', 'step2', 'step3', 'step4'];
    let current = 0;
    const btn = document.getElementById('startVerificationBtn');
    btn.disabled = true;
    
    const runStep = () => {
        if (current >= steps.length) {
            userVerified = true;
            updateUserBar();
            closeVerificationModal();
            logEvent(lang === 'ar' ? 'ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!' : 'Account Verified Successfully!');
            analyzeSeller(); // ØªØ´ØºÙŠÙ„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ«ÙŠÙ‚
            alert(lang === 'ar' ? 'Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… Ø§Ù„ØªÙˆØ«ÙŠÙ‚.' : 'Congratulations! Verified.');
            return;
        }
        const el = document.getElementById(steps[current]);
        el.classList.add('completed');
        el.querySelector('.step-number').classList.add('completed');
        el.querySelector('.step-number').innerHTML = '<i class="fa-solid fa-check"></i>';
        current++;
        setTimeout(runStep, 1000);
    };
    runStep();
}

window.openAddProductModal = function() { 
    document.getElementById('addProductModal').style.display = 'flex'; 
    document.getElementById('productAnalysisStatus').style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
}
window.closeAddProductModal = function() { document.getElementById('addProductModal').style.display = 'none'; }

window.toggleNetwork = function() {
    network = network === 'Testnet' ? 'Mainnet' : 'Testnet';
    updateUserBar();
    logEvent((lang === 'ar' ? 'ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ø´Ø¨ÙƒØ©: ' : 'Switched to: ') + network);
}
window.piConnect = function() {
    setTimeout(() => {
        piConnected = true;
        updateUserBar();
        logEvent(lang === 'ar' ? 'ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø©' : 'Wallet Connected');
    }, 500);
}
window.piLogout = function() {
    piConnected = false;
    userVerified = false;
    cart = [];
    renderCart();
    updateUserBar();
    logEvent(lang === 'ar' ? 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬' : 'Logged out');
}


// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© (INITIALIZE)
document.addEventListener('DOMContentLoaded', () => {
    renderCategories();
    renderProducts(PRODUCTS);
    updateUserBar();
    translateUI();
    renderDisputes();
    // Ø¨Ø¯Ø¡ Ù…Ø­Ø§ÙƒØ§Ø© Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© (Ù…Ø«Ù„ ORD-100)
    MOCK_ORDERS.forEach(order => {
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„ØªØ¨Ø¯Ùˆ Ø£Ù†Ù‡Ø§ ØªÙ… ØªÙˆØµÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„ÙØ¹Ù„
        if (order.status_en !== 'Delivered') {
            order.status_index = 3;
            order.status_ar = ORDER_STATUSES_AR[3];
            order.status_en = ORDER_STATUSES_EN[3];
        }
    });
});
</script>
</body>
</html>
